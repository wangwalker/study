# Swift

### ç‰ˆæœ¬æ¼”åŒ–

- é¡¹ç›®å¯åŠ¨ï¼š2010.7
- v1.0: 2014.8
- v2.0: 2015.9
  - error handleå¢å¼º
  - `guard`è¯­æ³•
  - åè®®æ”¯æŒæ‰©å±•
- v3.0: 2016.9
  - æ–°GCDå’ŒCore Graphics
  - ç§»é™¤NSå‰ç¼€
  - å†…è”åºåˆ—å‡½æ•°sequence
  - `fileprivate`ï¼Œ`open`å…³é”®å­—
  - ç§»é™¤å¼ƒç”¨è¿ç®—ï¼Œæ¯”å¦‚++ã€--ã€‚ä¸ºä»€ä¹ˆè¦ç§»é™¤ï¼Ÿ
    - ++ä¸æ¯”+=1ç®€æ´å¤šå°‘
    - ä¸å¸Œæœ›å’Œå…¶ä»–è¯­è¨€æ··æ·†
    - åœ¨åˆ«çš„è¯­è¨€ä¸­ä¸»è¦ç”¨åœ¨`for`å¾ªç¯ä¸­ï¼Œswiftä¸­çš„`for`å¾ªç¯ç”¨æ³•ä¸ä¸€æ ·
- v4.0: 2017.9
  - `extension`ä¸­å¯ä»¥è®¿é—®`private`å±æ€§
  - ç±»å‹å’Œåè®®çš„ç»„åˆç±»å‹
  - Associated Typeå¯ä»¥è¿½åŠ Whereçº¦æŸè¯­å¥
  - æ–°çš„Key Pathè¯­æ³•
  - ä¸‹æ ‡æ”¯æŒæ³›å‹
  - å­—ç¬¦ä¸²å¢å¼º
- v5.0: 2019.3
  - ABIç¨³å®š
  - Raw strings
  - æ ‡å‡†åº“æ–°å¢Results
  - å’ŒPythonã€Rubyäº’æ“ä½œçš„åŠ¨æ€å¯è°ƒç”¨ç±»å‹

### ä¸Objective-Cçš„åŒºåˆ«

| æ¯”è¾ƒé¡¹   | Swift                                                        | Objective-C                                               |
| -------- | ------------------------------------------------------------ | --------------------------------------------------------- |
| ç¼–ç¨‹èŒƒå¼ | é¢å‘åè®®ç¼–ç¨‹<br />é¢å‘å¯¹è±¡ç¼–ç¨‹<br />å‡½æ•°å¼ç¼–ç¨‹               | ä¸»è¦ä»¥é¢å‘å¯¹è±¡ä¸ºä¸»<br />å¯å¼•å…¥ReactiveCocoaå®ç°å‡½æ•°å¼ç¼–ç¨‹ |
| ç±»å‹å®‰å…¨ | ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥                                               | åŠ¨æ€ç‰¹æ€§å˜é‡ç±»å‹ä¸å®šï¼Œæ¯”å¦‚`id`ç±»å‹                        |
| å€¼ç±»å‹   | structã€enumã€tuple<br />Intã€Floatã€Stringã€Setç­‰éƒ½æ˜¯å€¼ç±»å‹ | NSNumberã€NSStringæ˜¯æŒ‡é’ˆç±»å‹                              |
| æšä¸¾     | æ”¯æŒæ›´å¤šç±»å‹ï¼Œåè®®ã€æ‰©å±•ï¼Œå±æ€§æ–¹æ³•ç­‰                         | åªæ˜¯ä¸€ä¸ªæ ‡è®°                                              |
| æ³›å‹     | æ”¯æŒï¼Œå¹¶ä¸”æ”¯æŒç±»å‹çº¦æŸç‰¹æ€§                                   | /                                                         |
| åè®®     | æ”¯æŒå¾ˆä¸°å¯Œï¼Œé…åˆæ‰©å±•ã€æ³›å‹ã€å…³è”ç±»å‹å¯å®ç°é¢å‘åè®®ç¼–ç¨‹<br />è¿˜å¯ä»¥ç”¨åˆ°å€¼ç±»å‹ä¸­ï¼Œæ¯”å¦‚structã€enumç­‰ | ç¼ºä¹å¼ºçº¦æŸï¼Œoptionalæ˜¯å¾ˆå¤šé—®é¢˜çš„æ¥æº                      |
| å‡½æ•°     | ä¸€ç­‰å…¬æ°‘ï¼Œå¯ä½œä¸ºå˜é‡ä¼ é€’ç»™å‡½æ•°ã€å±æ€§ç­‰                       | æ­¤ç­‰å…¬æ°‘ï¼Œè¦å€ŸåŠ©selectorå’Œblockå°è£…æ‰èƒ½å®ç°å¯¹åº”åŠŸèƒ½       |

### ç¼–è¯‘

##### æµç¨‹

![Swift Compile](../images/swift-compile-flow.png)

ä»Swiftä»£ç åˆ°æœºå™¨ä»£ç ï¼Œé‡è¦è¦ç»è¿‡è¿™äº›æ­¥éª¤ï¼š

- Swift ASTæŠ½è±¡è¯­æ³•æ ‘ï¼Œç”¨Swiftçš„Parseæ¨¡å—
- Swift IRï¼Œé€šè¿‡swiftcå‘½ä»¤è¡Œå·¥å…·å¾—åˆ°ä¸­é—´è¡¨ç¤ºï¼Œç”¨Semaå’ŒSILGenæ¨¡å—
- LLVM IRï¼Œç”¨Analysiså’ŒIRGenæ¨¡å—ç”Ÿæˆ
- executable codeï¼Œé€šè¿‡LLVMç¼–è¯‘å™¨è½¬æ¢æˆçœŸæ­£çš„æœºå™¨ä»£ç 

##### è¯­æ³•

- å¯æ‰§è¡Œæ–‡ä»¶ï¼š`swiftc -o main.out main.swift`
- æŠ½è±¡è¯­æ³•æ ‘ï¼š`swiftc main.swift -dump-ast`
- Swiftä¸­é—´è¡¨ç¤ºè¯­è¨€ï¼š `swiftc main.swift -emit-sil`
- LLVMä¸­é—´è¡¨ç¤ºè¯­è¨€ï¼› `swiftc main.swift -emit-ir`
- æ±‡ç¼–è¯­è¨€ï¼š `swiftc main.swift -emit-assembly`

æ›´å¤šçš„è¯­æ³•è§ï¼š[swiftc helps](https://gist.github.com/enomoto/7f11d57e4add7e702f9f84f34d3a0f8c)

# åŸºæœ¬æ•°æ®ç±»å‹

### å˜é‡ vs å¸¸é‡

å˜é‡å¸¸é‡éƒ½å¯ä»¥ä½¿ç”¨Unicodeï¼Œä½†ä¸èƒ½ä½¿ç”¨ç©ºç™½ç¬¦ã€æ•°å­¦ç¬¦å·ã€ç®­å¤´ä»¥åŠä¿ç•™çš„ã€‚ç”¨`let`å£°æ˜å¸¸é‡ï¼Œç”¨`var`å£°æ˜å˜é‡ã€‚

```swift
let a = 1	// can't change after declare
var b = 2
b = 3
```

### æ•°å€¼ç±»å‹

##### æ•´æ•°

åœ¨Swiftä¸­ï¼Œå¯ä»¥æ˜ç¡®æŒ‡å®šæ•´æ•°çš„ä½é•¿ï¼Œæ¯”å¦‚8ä½ã€16ä½ã€32ä½ã€64ä½ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®šä½æ•°ï¼Œç›´æ¥ä½¿ç”¨Intã€UIntï¼Œè¡¨ç¤ºå’Œå½“å‰å¹³å°çš„åŸç”Ÿå­—ç›¸åŒçš„é•¿åº¦ï¼Œæ¯”å¦‚åœ¨32ä½æœºå™¨ä¸Šå°±è¡¨ç¤º32ä½ã€‚

**å»ºè®®åœ¨ç”¨åˆ°æ•´æ•°çš„åœ°æ–¹ç»Ÿä¸€ä½¿ç”¨Intæˆ–è€…UInt**ã€‚

```swift
print("Int  : [\(Int.min) \(Int.max)]")			// "Int  : [-9223372036854775808 9223372036854775807]\n"
print("UInt : [\(UInt.min) \(UInt.max)]")		// "UInt : [0 18446744073709551615]\n"
print("Int32: [\(Int32.min) \(Int32.max)]")	// "Int32: [-2147483648 2147483647]\n"
```

##### æµ®ç‚¹æ•°

- Floatï¼Œ32ä½æµ®ç‚¹æ•°ï¼Œè‡³å°‘æœ‰6ä½æ•°å­—çš„ç²¾åº¦
- Doubleï¼Œ64ä½æµ®ç‚¹æ•°ï¼Œè‡³å°‘æœ‰15ä½æ•°å­—çš„ç²¾åº¦
- **åœ¨ä¸¤ç§ç±»å‹éƒ½å¯ä»¥ç”¨æ—¶ï¼Œå»ºè®®ä½¿ç”¨Doubleç±»å‹**

##### å¸ƒå°”å€¼

`true`å’Œ`false`ï¼Œåœ¨`if`ä¸­ï¼Œå¿…é¡»ä½¿ç”¨å¸ƒå°”å€¼ï¼Œä¸èƒ½ä½¿ç”¨å…¶ä»–ç±»å‹ã€‚**Swiftä¸ä¼šåšéšå¼è½¬æ¢ï¼Œå°†å…¶ä»–ç±»å‹è½¬æ¢ä¸ºå¸ƒå°”ç±»**ã€‚

##### ç±»å‹åˆ«å

å¯ä»¥ç”¨ç”¨`typealias`ä¸ºæŸä¸ªå·²ç»å­˜åœ¨çš„ç±»å‹å®šä¹‰ä¸€ä¸ªåˆ«åï¼Œå¯ä»¥æ›´åŠ å‡†ç¡®åœ°è¡¨è¾¾ä¸šåŠ¡é€»è¾‘ã€‚

```swift
typealias Duration = Float
let duration: Duration = 10.89
```

##### Tupleå…ƒç»„

æ¦‚å¿µæ¥æºäºPythonï¼Œè¡¨ç¤ºå°†å¤šä¸ªå•ä¸€ç±»å‹çš„å…ƒç´ ç»„åˆæˆå¤åˆå€¼ï¼Œé‡Œé¢å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œè€Œä¸åƒArrayè¦æ±‚ç±»å‹ä¸€è‡´ã€‚æ³¨æ„ğŸ“¢ï¼š**å…ƒç»„ä¸€æ—¦åˆ›å»ºå¥½ï¼Œå°±ä¸èƒ½ä¿®æ”¹ï¼Œæ¯”å¦‚æ·»åŠ å’Œåˆ é™¤å…ƒç»„**ã€‚

###### å…ƒç»„å‘½å

- æ¯ä¸ªå…ƒç´ éƒ½å¯ä»¥æŒ‡å®šå¯¹åº”çš„åç§°
- å¦‚æœæ²¡æœ‰æŒ‡å®šåç§°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹æ ‡çš„æ–¹å¼å¼•ç”¨

###### ä¿®æ”¹

- ç”¨varå£°æ˜çš„æ˜¯å¯å˜å…ƒç»„ï¼Œç”¨letå£°æ˜çš„æ˜¯ä¸å¯å˜å…ƒç»„
- å¯ä»¥å¯¹å¯å˜å…ƒç»„ä¿®æ”¹å…ƒç´ å€¼ï¼Œä½†ä¸èƒ½ä¿®æ”¹å…ƒç´ ç±»å‹
- **anyç±»å‹å¯ä»¥æ”¹ä¸ºä»»ä½•ç±»å‹**

###### åˆ†è§£

- å¯ä»¥å°†å…ƒç»„åˆ†è§£ä¸ºå•ä¸ªå˜é‡æˆ–å¸¸é‡
- å¦‚æœä¸éœ€è¦å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥ç”¨ä¸‹åˆ’çº¿ `_` è¡¨ç¤º

```swift
let error = (1, "No permission")
print(error)
print(error.0)

var anotherError = (errorCode:1, errorMessge: "No Permission")
print(anotherError.errorCode)
anotherError.errorCode = 2

var anyTypeError:(errorCode: Int, errorMessage: Any) = (errorCode: 1, errorMessage: "No Permission")
anyTypeError.errorMessage = false
```

##### Optionalå¯é€‰é¡¹

###### å¿…è¦æ€§

åœ¨å¾ˆå¤šè¯­è¨€ä¸­éƒ½æ²¡æœ‰è¿™ç§ç±»å‹ï¼Œé‚£ä¸ºä»€ä¹ˆéœ€è¦å¯é€‰å€¼è¿™ç§ç‹¬ç‰¹çš„ç±»å‹å‘¢ï¼Ÿä¸»è¦æ˜¯ä¸ºäº†**å»ºç«‹å®Œå¤‡ã€æ¸…æ™°çš„ç±»å‹ç³»ç»Ÿ**ã€‚åœ¨Objective-Cä¸­ï¼Œç”¨`nil`è¡¨ç¤ºç©ºæŒ‡é’ˆï¼Œä½†è¿™ç§æ–¹å¼å­˜åœ¨è¯¸å¤šä¸ä¾¿ï¼Œæ¯”å¦‚ï¼š

- `nil` æ²¡æœ‰ç±»å‹ä¿¡æ¯
- é›†åˆç±»å‹ä¸­ä¸èƒ½æœ‰ `nil`
- æ‰€æœ‰å¯¹è±¡ç±»å˜é‡éƒ½å¯ä»¥ä¸º `nil`
- åªèƒ½ç”¨åœ¨å¯¹è±¡ç±»å‹ä¸Šï¼Œå…¶ä»–åœ°æ–¹éœ€è¦ç”¨å…¶ä»–å€¼ï¼Œæ¯”å¦‚ `NULL`

###### ä½¿ç”¨

åœ¨Swiftä¸­ï¼Œé€šè¿‡åœ¨å˜é‡ç±»å‹åé¢æ·»åŠ ä¸€ä¸ª `?` ï¼Œå¯å°†å…¶å˜æˆå¯é€‰é¡¹ï¼Œ**å®ƒè¡¨ç¤ºå¯èƒ½å­˜åœ¨æŸä¸ªå€¼xï¼Œä¹Ÿå¯èƒ½æ ¹æœ¬ä¸å­˜åœ¨**ã€‚å¯ä»¥å°† `nil` èµ‹å€¼ç»™å¯é€‰å€¼é¡¹ï¼Œè¡¨ç¤ºç©ºå€¼ã€‚ä½†æ˜¯ï¼ŒObjective-Cä¸­çš„ `nil` å’ŒSwiftä¸­çš„ `nil` ä¹‹é—´å­˜åœ¨å¾ˆå¤§çš„å·®å¼‚ã€‚

- åœ¨Objective-Cä¸­ï¼Œ**nilè¡¨ç¤ºæŒ‡å‘ä¸€ä¸ªä¸å­˜åœ¨å¯¹è±¡çš„æŒ‡é’ˆ**
- åœ¨Swiftä¸­ï¼Œ**nilä¸æ˜¯æŒ‡é’ˆ**ï¼Œå®ƒåªæ˜¯å€¼ç¼ºå¤±çš„ä¸€ç§ç‰¹æ®Šç±»å‹

åœ¨Swiftä¸­ï¼Œå¯é€‰å€¼é¡¹ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œåªèƒ½é€šè¿‡ `!` å±•å¼€ä¹‹åæ‰èƒ½ä½¿ç”¨ã€‚ä½¿ç”¨Optionalçš„ä¸¤ç§æ–¹å¼ï¼š

- å…ˆåœ¨ `if` ä¸­åˆ¤æ–­æ˜¯å¦ä¸º `nil`ï¼Œå¦‚æœä¸æ˜¯ç”¨ `!` å±•å¼€å³å¯è·å¾—åŸå§‹å€¼
- **å¯é€‰ç»‘å®š**ã€‚åœ¨ `if` æˆ–è€… `while` è¯­å¥ä¸­ï¼Œèµ‹å€¼ç»™ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œè€Œä¸”ç”¨â€œï¼Œâ€å¯¹å¤šä¸ªOptionalåšå¯é€‰ç»‘å®š
- **éšå¼å±•å¼€**ã€‚å®šä¹‰å¯é€‰å€¼çš„æ—¶å€™ä¸ç”¨ `?` è€Œç”¨ `!` ï¼Œä½¿ç”¨æ—¶ä¾¿å¯è‡ªåŠ¨å±•å¼€ã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒå±é™©ã€‚

###### å¯é€‰é“¾

**å¦‚æœå¯é€‰é¡¹åœ¨å¤šä¸ªå˜é‡ä¹‹é—´ä¼ é€’**ï¼Œå°±æ„æˆä¸€æ¡å¯é€‰é“¾ã€‚åœ¨èµ‹å€¼çš„æ—¶å€™ï¼Œè¿˜è¦åœ¨å¯é€‰é¡¹åé¢åŠ ä¸Š `?` ï¼Œæ–°å˜é‡ä¾ç„¶æ˜¯ä¸€ä¸ªå¯é€‰å€¼å˜é‡ã€‚

```swift
let name: String? = "Walker"
print(name.count)		// errors

if name != nil {
    print(name!.count)
}
if let unwrappedName = name {
    print("\(unwrappedName) characters count: \(unwrappedName.count)")
}

let hiddenOptional: String! = "Hello"
print(hiddenOptional.count)

// å¯é€‰é“¾
let nameCount = name?.count
let index = nameCount - 1   // error, it is an optinal value
if let count = nameCount {
    print(count)
}
```

###### åŸç†

Optionalå®é™…ä¸Šæ˜¯Swiftæ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæšä¸¾enumç±»å‹ï¼Œç”¨ `none` è¡¨ç¤º `nil` ï¼Œç”¨ `some` è¡¨ç¤ºæŸä¸ªå€¼ï¼Œé€šè¿‡ `unsafelyUnwrapped` è§£åŒ…å…·ä½“çš„å€¼ï¼Œå¾—åˆ° `nil` æˆ–è€…æŸä¸ªçœŸå®å€¼ã€‚

```swift
@frozen public enum Optional<Wrapped> : ExpressibleByNilLiteral {

    /// The absence of a value.
    ///
    /// In code, the absence of a value is typically written using the `nil`
    /// literal rather than the explicit `.none` enumeration case.
    case none

    /// The presence of a value, stored as `Wrapped`.
    case some(Wrapped)
  ...
}
```

##### å­—ç¬¦ä¸²

###### åˆ›å»º

å­—ç¬¦ä¸²çš„åˆ›å»ºæ–¹å¼æ¯”è¾ƒå¤šï¼Œå½¢å¼ä¹Ÿæ¯”è¾ƒå¤šã€‚æ˜¯å€¼ç±»å‹ã€‚

- å•è¡Œå­—ç¬¦ä¸²
  - å­—é¢é‡
  - `String()` è¯­æ³•
- å¤šè¡Œå­—ç¬¦ä¸²
  - ä¸‰ä¸ª `"` æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²
- æ‰©å±•å­—ç¬¦ä¸²åˆ†éš”ç¬¦Raw String
  - æŠŠå­—ç¬¦ä¸²æ”¾åœ¨åŒ `"` å†…ï¼Œå¹¶ç”¨ `#` åŒ…è£¹
  - å¦‚æœå­—ç¬¦ä¸²ä¸­æœ‰ `#`ï¼Œåˆ™é¦–å°¾éœ€è¦ä¸¤ä¸ª `#`
  - è½¬ä¹‰å­—ç¬¦éœ€è¦åœ¨ `\` å’Œ `char` ä¹‹é—´æ”¾ç½®åŒæ ·æ•°é‡çš„ "#"

###### æ“ä½œ

- éå†
  - å¾—åˆ°Character
  - Characterç±»å‹çš„æ•°ç»„é€šè¿‡`String()`å¯åˆå§‹åŒ–å­—ç¬¦ä¸²
- æ‹¼æ¥
  - `+=`
  - `append()`ï¼Œè¿½åŠ 
- æ’å€¼
  - `\(someVar)  and strings...`
  - `String(format: **<#T##String#>**, **<#T##arguments: CVarArg...##CVarArg#>**)`

```swift
var weekday = "Tuesday"
var index = weekday.index(after: weekday.startIndex)
weekday.suffix(3)
weekday.prefix(3)
weekday.append(contentsOf: " is open")
weekday.insert(contentsOf: " there", at: weekday.endIndex)
weekday.removeSubrange(weekday.index(weekday.startIndex, offsetBy: 5)..<weekday.endIndex)
```

# è¿ç®—ç¬¦

### åŸºæœ¬æ“ä½œ

###### æ’æŸ¥é”™è¯¯

Swiftåœ¨æ”¯æŒCä¸­å¤§éƒ¨åˆ†è¿ç®—ç¬¦çš„åŒæ—¶ï¼Œè¿˜å¢åŠ äº†**æ’æŸ¥é”™è¯¯çš„èƒ½åŠ›**

- èµ‹å€¼è¿ç®—ç¬¦ `=` ä¸ä¼šè¿”å›å€¼ï¼Œä»¥é˜²æ­¢è¢«ç”¨åœ¨ç­‰äºç¬¦å· `==` ä¸Š
- ç®—æ•°ç¬¦å·(+ - * / %)å¯ä»¥æ£€æµ‹å€¼æº¢å‡ºï¼Œé¿å…æŸäº›å¥‡æ€ªçš„ç»“æœ

###### å¸¸è§è¿ç®—

- ä½™æ•°è¿ç®—ç¬¦ `a % b`
  - aä¸ºè´Ÿæ•°æ—¶ä¹Ÿå¯ä»¥è¿›è¡Œè®¡ç®—
  - bä¸ºè´Ÿæ•°æ—¶å’Œbä¸ºæ­£æ•°çš„ç»“æœä¸€æ ·ï¼Œ`a % b` == `a % -b`
- æº¢å‡ºè¿ç®—ç¬¦ï¼Œ**ç”¨å¸¸è§„è¿ç®—ç¬¦è®¡ç®—çš„å€¼è¶…è¿‡å˜é‡èƒ½å®¹çº³çš„èŒƒå›´æ—¶ä¼šæŠ¥é”™ï¼Œä½†æ˜¯æº¢å‡ºè¿ç®—ç¬¦ä¸ä¼š**
  - æº¢å‡ºåŠ æ³• `&+`
  - æº¢å‡ºå‡æ³• `&-`
  - æº¢å‡ºä¹˜æ³• `&*`
- åˆå¹¶ç©ºå€¼è¿ç®—ç¬¦ `a ?? b`
  - å¦‚æœå¯é€‰å€¼aæœ‰å€¼ï¼Œåˆ™å±•å¼€ï¼Œå¦åˆ™è¿”å›é»˜è®¤å€¼b
  - **aå¿…é¡»ä¸ºå¯é€‰é¡¹ï¼Œbå’Œaçš„ç±»å‹ç›¸åŒ**
  - å®é™…ä¸Šæ˜¯ä¸‰å…ƒè¿ç®—ç¬¦ `a != nil ? a! : b` çš„ç¼©å†™
- åŒºé—´è¿ç®—ç¬¦
  - é—­åŒºé—´è¿ç®—ç¬¦
    - `a...b` å®šä¹‰äº†ä»aåˆ°bä¹‹é—´çš„ä¸€ç»„èŒƒå›´
    - **aå’ŒbåŒ…å«åœ¨å†…ï¼Œä¸”a<=b**
  - å¼€åŒºé—´è¿ç®—ç¬¦
    - `a..<b`å®šä¹‰äº†ä»aåˆ°bä¹‹é—´çš„ä¸€ç»„èŒƒå›´ï¼Œä¸åŒ…å«b
    - a<=bï¼Œå½“a==bæ—¶è¿”å›ç©º
  - å•ä¾§åŒºé—´è¿ç®—ç¬¦
    - é—­åŒºé—´å¯¹åº”çš„å•ä¾§åŒºé—´`...2`æˆ–è€…`2...`
    - å¼€åŒºé—´å¯¹åº”çš„å•ä¾§åŒºé—´`..<2`
  - ComparableåŒºé—´
- ä½è¿ç®—ç¬¦
  - å–åè¿ç®—ç¬¦ `~` !0 = 1; !1=0
  - ä½ä¸è¿ç®—ç¬¦ `&` 1&1=1; 0&0 = 0&1 = 1&0 = 0  >>  `0&x = 0`
  - ä½æˆ–è¿ç®—ç¬¦ `| ` 0|0 = 0; 0|1 = 1|0 = 1|1 = 1   >>  `1|x = 1`
  - ä½å¼‚æˆ–è¿ç®—ç¬¦ `^` 1^1 = 0 ^ 0 = 0; 1^0=0^1 = 1>> ` 0^x = x`
  - å·¦ç§»ã€å³ç§»è¿ç®—ç¬¦ `<<`ã€`>>`

```swift
let a = 5
let b = 2
let e = a % -b										// e = 1

// æº¢å‡ºè¿ç®—ç¬¦
var uintmax: UInt8 = 255
uintmax += 10											// error
let uint8max: UInt8 = 255
var uint: UInt8 = uint8max &+ 10	// 9
let uint8min: UInt8 = 1
uint = uint8min &- 10							// 247

// é—­åŒºé—´
let ab = 1...5
let ba = 5...1										// error
for i in ab {
    print(i)
}																	// 1 2 3 4 5
// å¼€åŒºé—´
let months: [Int] = [31, 28, 31, 30]
for m in 0..<months.count {
    print("month \(m+1) has \(months[m]) days")
}
// å•ä¾§åŒºé—´
let range = ...5
range.contains(2)									// true
range.upperBound									// 5
range.self												// PartialRangeThrough<Int>
for n in months[1...] {
    print(n)
}
for n in months[...2] {
    print(n)
}
```

### ç»å…¸ç®—æ³•

ç”¨ä½è¿ç®—å¯ä»¥é«˜æ•ˆåœ°å®ç°å¾ˆå¤šç®—æ³•ï¼Œæ¯”å¦‚ä¸å€ŸåŠ©ä¸´æ—¶å˜é‡äº¤æ¢ä¸¤ä¸ªæ•°å­—ï¼Œæ— ç¬¦å·æ•°ä¸­çš„ä¸ªæ•°ç­‰ã€‚

##### äº¤æ¢ä¸¤ä¸ªæ•°å­—

```swift
func swapByBit(a: inout Int, b: inout Int) {
    a = a ^ b
    b = a ^ b
    a = a ^ b
}

func swapByAdd(a: inout Int, b: inout Int) {
    a = a + b
    b = a - b
    a = a - b
}
```

##### äºŒè¿›åˆ¶æ— ç¬¦å·æ•°ä¸­1çš„ä¸ªæ•°

å°†æ¯ä¸€ä½å’Œ1åšä¸æ“ä½œï¼Œå¦‚æœæ­¤ä½æ˜¯1ï¼Œé‚£ä¹ˆç»“æœä¹Ÿæ˜¯1ï¼Œä¸æ–­å³ç§»ç›´åˆ°æ•°å­—å˜æˆ0.

```swift
func computeBitOnes(n: Int) -> Int {
    var tmp = n
    var count = 0
    while tmp > 0 {
        count += tmp & 1
        tmp = tmp >> 1
    }
    return count
}
```

### è¿ç®—ç¬¦æ–¹æ³•

##### è¿ç®—ç¬¦é‡è½½

**ç±»å’Œç»“æ„ä½“å¯ä»¥ä¸ºç°æœ‰çš„è¿ç®—ç¬¦æä¾›è‡ªå®šä¹‰å®ç°ï¼Œç§°ä¹‹ä¸ºè¿ç®—ç¬¦é‡è½½**ã€‚å¯¹äºä¸€å…ƒè¿ç®—ç¬¦ï¼Œéœ€è¦åœ¨`func`å…³é”®å­—ä¹‹å‰é€šè¿‡`prefix`å’Œ`postfix`åˆ†åˆ«è¯´æ˜æ˜¯å‰ç¼€è¿˜æ˜¯åç¼€ã€‚

å¯¹äºç»„åˆè¿ç®—ç¬¦ï¼Œè¿˜è¦åœ¨è¦å€¼ä¼šæ”¹å˜çš„å˜é‡ä¹‹å‰ï¼ŒåŠ ä¸Š`inout`å…³é”®å­—ã€‚

```swift
struct Point {
    var x: Double = 0.0
    var y: Double = 0.0
}
extension Point {
    static func + (left: Point, right: Point) -> Point {
        return Point(x: left.x+right.x, y: left.y+right.y)
    }
  	static prefix func - (p: Point) -> Point {
        return Point(x: -p.x, y: -p.y)
    }
}
extension Point: CustomStringConvertible {
    var description: String {
        get {
            return "(\(x), \(y))"
        }
    }
}
let p1 = Point(x: 1.2, y: 3.2)			// (1.2, 3.2)
let p2 = Point(x: 2.1, y: 2.3)			// (2.1, 2.3)	
let p3 = p1 + p2										// (3.3, 5.5)
let p4 = -p3												// (-3.3, -5.5)
```

##### ç»„åˆèµ‹å€¼è¿ç®—ç¬¦

**ç»„åˆèµ‹å€¼è¿ç®—ç¬¦å°†èµ‹å€¼è¿ç®—ç¬¦ `=` ä¸å…¶å®ƒè¿ç®—ç¬¦è¿›è¡Œç»“åˆ**ã€‚åœ¨å®ç°çš„æ—¶å€™ï¼Œéœ€è¦æŠŠè¿ç®—ç¬¦çš„å·¦å‚æ•°è®¾ç½®æˆ `inout` ç±»å‹ï¼Œå› ä¸ºè¿™ä¸ªå‚æ•°çš„å€¼ä¼šåœ¨è¿ç®—ç¬¦å‡½æ•°å†…è¢«ä¿®æ”¹ã€‚

```swift
extension Point {
    static func += (left: inout Point, right: Point) {
        left = left + right
    }
    static func -= (left: inout Point, right: Point) {
        left = left + (-right)
    }
}
```

##### ç­‰ä»·è¿ç®—ç¬¦

è‡ªå®šä¹‰ç±»å’Œç»“æ„ä½“ä¸æä¾›ç­‰ä»·è¿ç®—ç¬¦ï¼ˆç­‰äºè¿ç®—ç¬¦ `==` å’Œä¸ç­‰äºè¿ç®—ç¬¦ ` !=`ï¼‰çš„é»˜è®¤å®ç°ã€‚è¦ä½¿ç”¨ç­‰ä»·è¿ç®—ç¬¦æ¥æ£€æŸ¥è‡ªå®šä¹‰ç±»å‹çš„ç­‰ä»·æ€§ï¼Œéœ€è¦å’Œå…¶ä»–ä¸­ç¼€è¿ç®—ç¬¦ä¸€æ ·é‡è½½ç­‰äºè¿ç®—ç¬¦ `==`ï¼Œå¹¶éµå¾ªæ ‡å‡†åº“çš„ Equatable åè®®

```swift
extension Point: Equatable {
    static func == (left: Point, right: Point) -> Bool {
        return left.x == right.x && left.y == right.y
    }
}
```

å…¶å®ï¼ŒSwiftä¸ºéµå¾ªEquatableåè®®çš„ç±»å‹æä¾›äº†ç­‰ä»·è¿ç®—ç¬¦çš„åˆæˆå®ç°ã€‚

- åªæ‹¥æœ‰éµå¾ª Equatable åè®®å­˜å‚¨å±æ€§çš„ç»“æ„ä½“
- åªæ‹¥æœ‰éµå¾ª Equatable åè®®å…³è”ç±»å‹çš„æšä¸¾
- æ²¡æœ‰å…³è”ç±»å‹çš„æšä¸¾

##### è‡ªå®šä¹‰è¿ç®—ç¬¦

é™¤äº†å®ç°æ ‡å‡†è¿ç®—ç¬¦ï¼Œåœ¨ Swift å½“ä¸­è¿˜å¯ä»¥å£°æ˜å’Œå®ç°è‡ªå®šä¹‰è¿ç®—ç¬¦ï¼ˆcustom operatorsï¼‰ã€‚æ–°çš„è¿ç®—ç¬¦è¦åœ¨å…¨å±€ä½œç”¨åŸŸå†…ï¼Œä½¿ç”¨`operator` å…³é”®å­—è¿›è¡Œå£°æ˜ï¼ŒåŒæ—¶è¿˜è¦æŒ‡å®š `prefix` ã€`infix` æˆ–è€… `postfix` é™å®šç¬¦ã€‚

```swift
prefix operator ++
extension Point {
    static prefix func ++ (p: inout Point) {
        p += p
    }
}
++p4		// (-6.6, -11.0)
```

å¦‚æœè¦è‡ªå®šä¹‰ä¸­ç¼€è¿ç®—ç¬¦ï¼Œä¸ºäº†å°†æ‰€æœ‰è¿ç®—è§„åˆ™ç»Ÿä¸€å¤„ç†ï¼Œè¿˜éœ€è¦æŒ‡æ˜å®ƒçš„ä¼˜å…ˆçº§å’Œç»“åˆæ€§ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ä¼˜å…ˆçº§ç»„æ¥å®ç°ã€‚

```swift
precedencegroup PointAddMinusPrecedence {
    associativity: left
    lowerThan: AdditionPrecedence
}
precedencegroup PointMultiplyMinusPrecedence {
    associativity: left
    higherThan: PointAddMinusPrecedence
    lowerThan: AdditionPrecedence
}

infix operator +-: PointAddMinusPrecedence
infix operator *-: PointMultiplyMinusPrecedence

extension Point {
    static func +- (left: Point, right: Point) -> Point {
        return Point(x: left.x + right.x, y: left.y - right.y)
    }
    static func *- (left: Point, right: Point) -> Point {
        return Point(x: left.x * left.y, y: left.y - right.y)
    }
}
```

# éå†

### for

ä½¿ç”¨ `for-in` å¾ªç¯æ¥éå†åºåˆ—ï¼Œæ¯”å¦‚ä¸€ä¸ªèŒƒå›´å†…çš„æ•°å­—ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ æˆ–è€…å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ã€‚å½“éå†å­—å…¸æ—¶ï¼Œæ¯ä¸€ä¸ªå…ƒç´ éƒ½è¿”å›ä¸€ä¸ª (key, value) å…ƒç»„ï¼Œå¯ä»¥åœ¨ for-in å¾ªç¯ä½“ä¸­ä½¿ç”¨æ˜¾å¼å‘½åå¸¸é‡æ¥åˆ†è§£ (key, value) å…ƒç»„æˆå‘˜ã€‚

å¦‚æœä¸éœ€è¦å€¼ï¼Œå¯ä»¥ç”¨ä¸‹åˆ’çº¿`_`å¿½ç•¥ã€‚

```swift
let scholarship: [Int: Int] = [1: 2000, 2: 5000, 3:800]
for (level, money) in scholarship {
    print("scholarship level \(level) worth \(money)")
}
for s in scholarship {
    print("scholarship level \(s.0) worth \(s.1)")
}
```

**å¦‚æœåªéå†ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥é€šè¿‡åˆ†æ®µåŒºé—´æ¥å®ç°**ã€‚

- ä½¿ç”¨ `stride(from:to:by:)` å‡½æ•°æ¥è·³è¿‡ä¸æƒ³è¦çš„æ ‡è®° (å¼€åŒºé—´)
- é—­åŒºé—´ä¹ŸåŒæ ·é€‚ç”¨ï¼Œä½¿ç”¨ `stride(from:through:by:)` å³å¯

ä»å­—é¢æ„æ€ç†è§£ï¼Œä¸¤è€…ä¹‹é—´çš„åŒºåˆ«åœ¨äºå‰è€…æ˜¯å¼€åŒºé—´ï¼Œåè€…æ˜¯é—­åŒºé—´ã€‚

```swift
for i in stride(from: 0, to: 10, by: 2) {
    print(i)
}
// 0 2 4 6 8
for i in stride(from: 0, through: 10, by: 2) {
    print(i)
}
// 0 2 4 6 8 10
```

### while

Swiftä¸­ï¼Œ`do...while`éœ€è¦ç”¨`repeat...while`æ›¿ä»£ã€‚

```swift
var count = 5
repeat {
    print(count)
    count -= 1
} while count > 0
```

### switch

Swiftä¸­çš„ `switch` è¯­å¥éå¸¸å¼ºå¤§ï¼Œä¸ä½†èƒ½å¤Ÿå®ç°å…¶ä»–è¯­è¨€ä¸­ç±»ä¼¼çš„åŠŸèƒ½ï¼Œè¿˜èƒ½å®ç°å¾ˆå¤šå…¨æ–°åŠŸèƒ½ã€‚

**switchè¯­å¥ä¸€å®šæ˜¯å…¨é¢çš„**ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºæ¯ä¸€ä¸ªå˜é‡ç±»å‹ï¼Œéƒ½è¦ä¸ºæ¯ä¸€ç§ `case` æä¾›å¤„ç†é€»è¾‘ï¼Œå¦åˆ™ç”¨ä¸€ä¸ª `default` åˆ†æ”¯å¤„ç†ã€‚å°¤å…¶åœ¨å¯¹ `enum` ç±»å‹åš `switch` éå†æ—¶ï¼Œé»˜è®¤ä¼šæä¾›æ‰€æœ‰ `case`ï¼Œè€Œä¸”æ¯ä¸€ä¸ª `case`ä¸­éœ€è¦è‡³å°‘æä¾›ä¸€è¡Œå¯æ‰§è¡Œä»£ç ã€‚

```swift
switch state {
    case .failure:
    	print("you are failure")
    case .next:
    	print("and next")
    case .success:
    	print("congratuations, you are an winner!")
}
```

å¦å¤–ä¸€ç‚¹éœ€è¦æ³¨æ„ğŸ“¢çš„æ˜¯ï¼Œç›¸æ¯” C å’Œ Objective-C é‡Œçš„ `switch` ï¼Œ**Swift é‡Œçš„ `switch` è¯­å¥é»˜è®¤ä¸ä¼šä»åŒ¹é… case çš„æœ«å°¾è´¯ç©¿åˆ°ä¸‹ä¸€ä¸ª case é‡Œ**ã€‚

##### åŒºé—´åŒ¹é…

å¯¹äºæ•°å€¼ç±»å‹å˜é‡ï¼ˆæ•´æ•°ã€æµ®ç‚¹æ•°ï¼‰ï¼Œå¯ä»¥é€šè¿‡æŸä¸ªå¤šä¸ªcaseåŒ¹é…æ˜¯å¦åœ¨å¯¹åº”åŒºé—´ã€‚è¿™ä¼šè®©ä»£ç çš„å¯è¯»æ€§å¢å¼ºï¼Œå› ä¸ºåœ¨ä¸æä¾›è¿™ç§æœºåˆ¶æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ `if` ä¸æ–­åœ°åšå¤šç§å¤æ‚åˆ¤æ–­ã€‚

```swift
let someNumber: Float = 13.0
// let someNumber: Int = 13
switch someNumber {
case 0...3:
    print("some number is in [0, 3]")
case 4...10:
    print("some number is in [4, 10]")
case ...100:
    print("some number is in [11, 100]")
default:
    print("some number greater than 100")
}
// some number is in [11, 100]
```

##### å…ƒç»„åŒ¹é…

å¯ä»¥ä½¿ç”¨å…ƒç»„åœ¨ä¸€ä¸ª `switch` è¯­å¥ä¸­æµ‹è¯•å¤šä¸ªå€¼ï¼Œå¦‚æœä¸ç”¨æŸä¸ªå…ƒç´ ï¼Œå¯ä»¥ç”¨ `_` å¿½ç•¥ã€‚

`switch` çš„ `case` å¯ä»¥å°†åŒ¹é…åˆ°çš„å€¼ä¸´æ—¶ç»‘å®šä¸ºä¸€ä¸ªå¸¸é‡æˆ–è€…å˜é‡ï¼Œæ¥ç»™ `case` çš„å‡½æ•°ä½“ä½¿ç”¨ã€‚å¦‚æœä½¿ç”¨ `var` å…³é”®å­—ï¼Œä¸´æ—¶çš„å˜é‡å°±ä¼šä»¥åˆé€‚çš„å€¼æ¥åˆ›å»ºå¹¶åˆå§‹åŒ–ã€‚å¯¹è¿™ä¸ªå˜é‡çš„ä»»ä½•æ”¹å˜éƒ½åªä¼šåœ¨ `case` çš„å‡½æ•°ä½“å†…æœ‰æ•ˆã€‚

è€Œä¸”ï¼Œ`switch case` å¯ä»¥ä½¿ç”¨ `where` åˆ†å¥æ¥æ£€æŸ¥æ˜¯å¦ç¬¦åˆç‰¹å®šçš„çº¦æŸã€‚

```swift
private func convertToPosition(at index: Int) -> MinePosition {
    let xy = (index / config.cols, index % config.cols)
    var position: MinePosition
    switch xy {
    case (0, 0):
        position = .topLeftCorner
    case (0, config.cols-1):
        position = .topRightCorner
    case (config.rows-1, 0):
        position = .bottomLeftCorner
    case (config.rows-1, config.cols-1):
        position = .bottomRightCorner
    case (0, 1..<config.cols-1):
        position = .topEdge
    case (1..<config.rows-1, 0):
        position = .leftEdge
    case (1..<config.rows-1, config.cols-1):
        position = .rightEdge
    case (config.rows-1, 1..<config.cols-1):
        position = .bottomEdge
    default:
        position = .inside
    }
    return position
}
```

##### å¤åˆåŒ¹é…

å¤šç§æƒ…å½¢å…±äº«åŒä¸€ä¸ªå‡½æ•°ä½“çš„å¤šä¸ªæƒ…å†µæ—¶ï¼Œå¯ä»¥åœ¨ `case` åå†™å¤šä¸ªæ¨¡å¼ï¼Œåœ¨æ¯ä¸ªæ¨¡å¼ä¹‹é—´ç”¨é€—å·åˆ†éš”ã€‚å¦‚æœä»»ä½•ä¸€ä¸ªæ¨¡å¼åŒ¹é…äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæƒ…å†µéƒ½ä¼šè¢«è®¤ä¸ºæ˜¯åŒ¹é…çš„ã€‚å¦‚æœæ¨¡å¼å¤ªé•¿ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒä»¬å†™æˆå¤šè¡Œã€‚

å¤åˆåŒ¹é…åŒæ ·å¯ä»¥åŒ…å«å€¼ç»‘å®šã€‚æ‰€æœ‰å¤åˆåŒ¹é…çš„æ¨¡å¼éƒ½å¿…é¡»åŒ…å«ç›¸åŒçš„å€¼ç»‘å®šé›†åˆï¼Œå¹¶ä¸”å¤åˆæƒ…å†µä¸­çš„æ¯ä¸€ä¸ªç»‘å®šéƒ½è¦æœ‰ç›¸åŒçš„ç±»å‹æ ¼å¼ã€‚è¿™æ‰èƒ½ç¡®ä¿æ— è®ºå¤åˆåŒ¹é…çš„é‚£éƒ¨åˆ†å‘½ä¸­äº†ï¼Œæ¥ä¸‹æ¥çš„å‡½æ•°ä½“ä¸­çš„ä»£ç éƒ½èƒ½è®¿é—®åˆ°ç»‘å®šçš„å€¼å¹¶ä¸”å€¼çš„ç±»å‹ä¹Ÿéƒ½ç›¸åŒã€‚

# 